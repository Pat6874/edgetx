//
// WARNING: DO NOT EDIT THIS FILE
//   This file has been generated from the target's JSON hardware description
//

static const stm32_adc_input_t _ADC_inputs[] = {
{% for input in adc_inputs.inputs %}
  {
    "{{ input.name }}",
    ADC_INPUT_{{ input.type }},
    {{ input.gpio if input.gpio else 'nullptr' }},
    {{ input.pin if input.gpio else '0' }},
    {{ input.channel if input.channel else '0' }},
    {{ '1 // inverted' if input.inverted else '0 // normal' }}
  },
{% endfor %}
};

{% for adc in adc_inputs.adcs %}
{% set inputs = adc_inputs.inputs | selectattr('adc', '==', adc.name) %}
static const uint8_t _ADC_{{ adc.name }}_channels[] = {
  {% for input in inputs %}
    {% if input.channel %}
    {{ adc_index[input.name] }},
    {% endif %}
  {% endfor %}
};

{% endfor %}
static const stm32_adc_t _ADC_adc[] = {
{% set ns = namespace(start_offs=0) %}
{% for adc in adc_inputs.adcs %}
  {% set inputs = adc_inputs.inputs | selectattr('adc', '==', adc.name) | selectattr('channel') %}
  {% set input_count = inputs | list | count %}
  {
    {{ adc.adc }},
    {{ adc.dma if adc.dma else 'nullptr' }},
    {{ adc.dma_channel if adc.dma else '0' }},
    {{ adc.dma_stream if adc.dma else '0' }},
    {{ adc.dma_stream_irq if adc.dma else '(IRQn_Type)-1' }},
    _ADC_{{ adc.name }}_channels,
    {{ input_count }},
    {{ adc.sample_time if adc.sample_time else '0' }}
  },
  {% set ns.start_offs = ns.start_offs + input_count %}
{% endfor %}
};

{% for adc in adc_inputs.adcs %}
  {% if adc.dma %}
extern "C" void {{ adc.dma_stream_irq_handler }} (void)
{
  stm32_hal_adc_isr(&_ADC_adc[{{ loop.index0 }}]);
}
  {% endif %}
{% endfor %}

{% for adc_gpio, adc_inputs in adc_gpios.items() | sort %}
static const uint32_t _ADC_{{ adc_gpio }}_pins[] = {
  {% for input in adc_inputs %}
    {{ input.pin }},
  {% endfor %}
};

{% endfor %}
static const stm32_adc_gpio_t _ADC_GPIOs[] = {
{% for adc_gpio, adc_inputs in adc_gpios.items() | sort %}
  { {{ adc_gpio }}, _ADC_{{ adc_gpio }}_pins, {{ adc_inputs|count }} },
{% endfor %}
};

{% set stick_inputs = adc_inputs.inputs | selectattr('type', '==', 'STICK') %}
static const char* _stick_inputs[] = {
  {% for input in stick_inputs %}
    "{{ input.name }}",
  {% endfor %}
};

static const char* _pot_inputs[] = {
  {% for input in adc_inputs.inputs %}
    {% if input.type == 'POT' or input.type == 'SLIDER' %}
    "{{ input.name }}",
    {% endif %}  
  {% endfor %}
};

